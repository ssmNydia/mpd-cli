#!/usr/bin/env node
const fs = require('fs')
const path = require('path')
const cli = require('../lib/cli')
const update = require('../lib/update')

cli.info('获取当前项目开发时的版本号...')
// 帮助旧版本创建的代码 适用于 新版本
cli.setup({
  noArgs: true,
  help: [
    '',
    '  Examples:',
    cli.chalk.gray('    # 更新代码写法适应新版mpd-cli书写规则'),
    '    $ mpd update'
  ].join('\n')
})

const package = require(path.resolve(process.cwd(), 'package.json'))
const curVersion = package['mpd-cli-version'] || ''
const newVersion = require('../package').version

const cfpath = path.resolve(process.cwd(), cli.program.config || 'mpd.config.js')
let defconf = {}

if(fs.existsSync(cfpath)){
  defconf = require(cfpath)
}
const conf = Object.assign(
  defconf.isH5 || {isH5: false},
  defconf.lessTheme || {},
  defconf.dev || {},
  defconf.plugins || {},
  {cliConfPath: cfpath}
)

update(curVersion, newVersion, conf)
